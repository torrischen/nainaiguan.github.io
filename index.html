<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="https://nainaiguan.github.io/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://nainaiguan.github.io"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-FABRIC" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/04/27/FABRIC/" class="article-date">
  <time class="dt-published" datetime="2021-04-27T06:30:32.000Z" itemprop="datePublished">2021-04-27</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/04/27/FABRIC/">FABRIC</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="How-to-build-Fabric-Network-on-four-servers"><a href="#How-to-build-Fabric-Network-on-four-servers" class="headerlink" title="How to build Fabric Network on four servers."></a>How to build Fabric Network on four servers.</h1><p>The whole network includes an orderer and two peers belonging to two different organizations. In this blog, we put the orderer on one server, the cli, ca_orderer, ca_org1 and ca_org2 on one server and two organizations on another two servers. Here, we use debian10.7 as the operating system. This OS should include python 3.</p>
<h3 id="TO-BEGIN-WITH-BUILD-THE-ENVIRONMENT"><a href="#TO-BEGIN-WITH-BUILD-THE-ENVIRONMENT" class="headerlink" title="TO BEGIN WITH, BUILD THE ENVIRONMENT"></a>TO BEGIN WITH, BUILD THE ENVIRONMENT</h3><p>We need docker, docker-compose, GO lang. These three are of necessity. If you want to compile with java, install your jdk(please note the version you need), gradle, etc. And if you decide to compile with javascript, it is a good choice to install npm and nodejs. Anyway, it’s up to you. </p>
<p>Here are the steps.</p>
<p>Uninstall old versions of docker. (we usually call them docker, docker.io or docker-engine)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get remove docker docker-engine docker.io containerd runc</span><br></pre></td></tr></table></figure>

<p>Update the apt index</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br></pre></td></tr></table></figure>

<p>Install docker(install apt dependency and get repository with HTTPS)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install \</span><br><span class="line">    apt-transport-https \</span><br><span class="line">    ca-certificates \</span><br><span class="line">    curl \</span><br><span class="line">    gnupg2 \</span><br><span class="line">    software-properties-common</span><br></pre></td></tr></table></figure>

<p>Add the official key</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -fsSL https:&#x2F;&#x2F;mirrors.ustc.edu.cn&#x2F;docker-ce&#x2F;linux&#x2F;debian&#x2F;gpg | sudo apt-key add -</span><br></pre></td></tr></table></figure>

<p>Make sure that you have had the key with fingerprint</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-key fingerprint 0EBFCD88</span><br><span class="line">&#x2F;&#x2F;you will see the following text if succeed</span><br><span class="line">pub   4096R&#x2F;0EBFCD88 2017-02-22</span><br><span class="line">      Key fingerprint &#x3D; 9DC8 5822 9FC7 DD38 854A  E2D8 8D81 803C 0EBF CD88</span><br><span class="line">uid                  Docker Release (CE deb) &lt;docker@docker.com&gt;</span><br><span class="line">sub   4096R&#x2F;F273FCD8 2017-02-22</span><br></pre></td></tr></table></figure>

<p>Update the apt index</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br></pre></td></tr></table></figure>

<p>Install the latest Docker-Engine-Community and containerd.io</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install docker-ce docker-ce-cli containerd.io</span><br></pre></td></tr></table></figure>

<p>Check if the install is successful</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker version</span><br></pre></td></tr></table></figure>

<p><strong>tips: make sure that you have add docker to the user group</strong></p>
<p>Install docker (we use 1.24.1 as an example)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo curl -L &quot;https:&#x2F;&#x2F;github.com&#x2F;docker&#x2F;compose&#x2F;releases&#x2F;download&#x2F;1.24.1&#x2F;docker-compose-$(uname -s)-$(uname -m)&quot; -o &#x2F;usr&#x2F;local&#x2F;bin&#x2F;docker-compose</span><br></pre></td></tr></table></figure>

<p>Give executive authority to docker-compose</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo chmod +x &#x2F;usr&#x2F;local&#x2F;bin&#x2F;docker-compose</span><br></pre></td></tr></table></figure>

<p>Check if you have succeeded</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose --version</span><br></pre></td></tr></table></figure>

<p><strong>tips: make sure you have given the executive authority!</strong></p>
<p>Download go.tar with wget and url(here we use the version of 1.13.4)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https:&#x2F;&#x2F;dl.google.com&#x2F;go&#x2F;go1.13.4.linux-amd64.tar.gz</span><br></pre></td></tr></table></figure>

<p>Unzip and move go file to <strong>/usr/local</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -xvf go1.13.4.linux-amd64.tar.gz &amp;&amp; mv go &#x2F;usr&#x2F;local</span><br></pre></td></tr></table></figure>

<p>Set environment variables</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">vim &#x2F;etc&#x2F;profile</span><br><span class="line"></span><br><span class="line">add the following text between &quot;&#x2F;&#x2F;&quot;</span><br><span class="line">&#x2F;&#x2F;</span><br><span class="line">export GOROOT&#x3D;&#x2F;usr&#x2F;local&#x2F;go</span><br><span class="line">export GOPATH&#x3D;&#x2F;home&#x2F;go</span><br><span class="line">export PATH&#x3D;$PATH:&#x2F;usr&#x2F;local&#x2F;go&#x2F;bin</span><br><span class="line">&#x2F;&#x2F;</span><br><span class="line"></span><br><span class="line">source &#x2F;etc&#x2F;profile</span><br></pre></td></tr></table></figure>

<p>Check if you have succeeded</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go version</span><br></pre></td></tr></table></figure>

<p><strong>Now, you have succeeded in installing docker, docker-compose and GO lang! Choose your compile environment and install as you like. You have quite a lot of choices, but remember that you should have at least one compile environment(Java,javascript…..).</strong></p>
<h3 id="GIT-CLONE-THE-OPEN-SOURCE-OF-FABRIC-AND-PULL-THE-IMAGES"><a href="#GIT-CLONE-THE-OPEN-SOURCE-OF-FABRIC-AND-PULL-THE-IMAGES" class="headerlink" title="GIT CLONE THE OPEN SOURCE OF FABRIC AND PULL THE IMAGES"></a>GIT CLONE THE OPEN SOURCE OF FABRIC AND PULL THE IMAGES</h3><p>Here in this blog, we use fabric 2.3.1.</p>
<p>Steps are as follows.</p>
<p>Git clone the open source of fabric</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd ~</span><br><span class="line">git clone https:&#x2F;&#x2F;github.com&#x2F;hyperledger&#x2F;fabric.git</span><br></pre></td></tr></table></figure>

<p>If you are Chinese and you are downloading at a low speed. Try the following method.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https:&#x2F;&#x2F;github.com.cnpmjs.org&#x2F;hyperledger&#x2F;fabric.git</span><br></pre></td></tr></table></figure>

<p>Use bootstrap.sh to pull images under the root path</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd ~&#x2F;fabric&#x2F;script</span><br><span class="line">mv bootstrap.sh ~</span><br><span class="line">.&#x2F;bootstrap.sh</span><br></pre></td></tr></table></figure>

<p>Also,if you are Chinese and you are downloading at a low speed. Try the following method.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vim ~&#x2F;bootstrap.sh</span><br><span class="line">&#x2F;&#x2F;use mirror site </span><br><span class="line">&#x2F;&#x2F;you should add &quot;.cnpm.org&quot; behind &quot;github.com&quot; in the url</span><br><span class="line">&#x2F;&#x2F;you can also use vpn as well</span><br></pre></td></tr></table></figure>

<p>Set environment variables</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">vim &#x2F;etc&#x2F;profile</span><br><span class="line"></span><br><span class="line">add the following text between &quot;&#x2F;&#x2F;&quot;</span><br><span class="line">&#x2F;&#x2F;</span><br><span class="line">export PATH&#x3D;$PATH:$GOROOT&#x2F;bin:$GOPATH&#x2F;bin:&#x2F;root&#x2F;fabric-samples&#x2F;bin</span><br><span class="line">&#x2F;&#x2F;</span><br><span class="line"></span><br><span class="line">source &#x2F;etc&#x2F;profile</span><br></pre></td></tr></table></figure>

<p>If you are in China, get your accelerator address on <a target="_blank" rel="noopener" href="https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors">https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p &#x2F;etc&#x2F;docker</span><br><span class="line">tee &#x2F;etc&#x2F;docker&#x2F;daemon.json &lt;&lt;-&#39;EOF&#39;</span><br><span class="line"> &#123;</span><br><span class="line"> &quot;registry-mirrors&quot;: [&quot;the accelerator address you get on the site above&quot;]</span><br><span class="line"> &#125;</span><br><span class="line"> EOF</span><br><span class="line"> </span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl restart docker</span><br></pre></td></tr></table></figure>

<p>Congratulations! You have succeeded in the first step. You can now start your first fabric test-network. Read the official docs on the site <a target="_blank" rel="noopener" href="https://hyperledger-fabric.readthedocs.io/en/latest/getting_started_run_fabric.html">https://hyperledger-fabric.readthedocs.io/en/latest/getting_started_run_fabric.html</a> to learn more about fabric.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">cd ~&#x2F;fabric-samples&#x2F;test-network</span><br><span class="line"></span><br><span class="line">.&#x2F;network.sh up createChannel -c mychannel -ca &amp;&amp; .&#x2F;network.sh deployCC -ccn ChaincodeName -ccp ChaincodePath -ccl ChaincodeLanguage</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;here we run a java app as an example, you need gradle environment in this step</span><br><span class="line"></span><br><span class="line">cd ~&#x2F;fabric-samples&#x2F;asset-transfer-basic&#x2F;application-java</span><br><span class="line"></span><br><span class="line">gradle runapp</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;then you will see the transaction details</span><br></pre></td></tr></table></figure>

<p><strong>Now you have succeeded in building the fabric network on a single server.</strong></p>
<h3 id="FINALLY-CHANGE-FROM-ONE-SERVER-TO-FOUR-SERVERS"><a href="#FINALLY-CHANGE-FROM-ONE-SERVER-TO-FOUR-SERVERS" class="headerlink" title="FINALLY,CHANGE FROM ONE SERVER TO FOUR SERVERS"></a>FINALLY,CHANGE FROM ONE SERVER TO FOUR SERVERS</h3><p>If you have read the <strong>network.sh</strong> line by line and understood each step written in the script. Just go ahead. If you haven’t, stop right here and read the script quite carefully and you will learn a lot.</p>
<p>Now, the first step is that you must check the environment on all the four servers and make sure they are all the same. </p>
<p><strong>Premise:</strong></p>
<p><strong>cli, ca_orderer, ca_org1, ca_org2 on server0</strong></p>
<p><strong>orderer on server1</strong></p>
<p><strong>peer0.org1.example.com on server3</strong></p>
<p><strong>peer0.org2.example.com on server4</strong></p>
<p>After the preparation, let’s start.</p>
<p>Modify docker-compose-test-net.yaml and docker-compose-ca.yaml (you only need to modify the test-net.yaml on server1,2,3)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;cd to the path of your files(fabric-samples&#x2F;docker)</span><br><span class="line">vim docker-compose-test-net.yaml</span><br><span class="line">&#x2F;&#x2F;retain what you need and delete the spare(example:on server 3,you only need the config of org1)</span><br><span class="line">&#x2F;&#x2F;now add the extra_host at the bottom(behind the ports and networks)</span><br><span class="line">&#x2F;&#x2F;here is an example</span><br><span class="line"></span><br><span class="line">    extra_hosts:</span><br><span class="line">      - &quot;example.com:ip&quot;</span><br><span class="line">      - &quot;orderer.example.com:ip&quot;</span><br><span class="line">      - &quot;peer0.org1.example.com:ip&quot;</span><br><span class="line">      - &quot;peer0.org2.example.com:ip&quot;</span><br><span class="line">      </span><br></pre></td></tr></table></figure>



<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;cd to the path of your files(fabric-samples&#x2F;docker)</span><br><span class="line">vim docker-compose-ca.yaml</span><br><span class="line">&#x2F;&#x2F;now add the extra_host at the bottom(behind the ports and networks)</span><br><span class="line">&#x2F;&#x2F;here is an example</span><br><span class="line"></span><br><span class="line">    extra_hosts:</span><br><span class="line">      - &quot;example.com:ip&quot;</span><br><span class="line">      - &quot;orderer.example.com:ip&quot;</span><br><span class="line">      - &quot;peer0.org1.example.com:ip&quot;</span><br><span class="line">      - &quot;peer0.org2.example.com:ip&quot;</span><br><span class="line">      </span><br><span class="line">tips:there are three &quot;extra_hosts&quot;(behind ca_org1,org2,orderer)</span><br></pre></td></tr></table></figure>

<p>Now, on server0.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;the path you operate under should be consistent with network.sh. Otherwise, more configs should be modified.</span><br><span class="line"></span><br><span class="line">cd docker</span><br><span class="line">docker-compose -f docker-compose-ca.yaml up -d &#x2F;&#x2F;build ca_org and ca_orderer</span><br><span class="line">docker-compose -f docker-compose-test-net.yaml up -d &#x2F;&#x2F;build cli</span><br></pre></td></tr></table></figure>

<p>These steps will add new files to the <strong>organizations</strong> folder(test-network/organizations). Now you should transfer organizations folder to server1,server2 and server3. Put them under the path of <strong>fabric-samples/test-network</strong>.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://nainaiguan.github.io/2021/04/27/FABRIC/" data-id="cknztevsr0000sktz6v8r2erk" data-title="FABRIC" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  


</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">April 2021</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/04/27/FABRIC/">FABRIC</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2021 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>